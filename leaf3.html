<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Leaflet</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
    <link rel="stylesheet" href="Control.OSMGeocoder.css"/>
  </head>
  <body>
    <div id="map" style="width: 100%; height: 800px;"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/2.1.0/leaflet.draw.js"></script>
    <script src="Control.OSMGeocoder.js"></script>
    <script>
        function init(){
            var lat = 38.986675;
            var lon = -76.939507;
            var zoomlevel = 16;
            var map = L.map('map', {center: [lat, lon], zoom: zoomlevel});

            L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Add Marker 
            var Icon = L.icon({iconUrl: 'school.png', iconSize: [32, 32]});
            L.marker([lat, lon], {icon:Icon}).addTo(map).bindPopup('University of Maryland');

            //Create Tool Bar
            var drawnItems = new L.FeatureGroup();
            map.addLayer(drawnItems);

            var drawControl = new L.Control.Draw({
                edit: {
                    featureGroup: drawnItems
                },
                draw: {
                    polygon: {
                        allowIntersection: false,
                        showArea: true
                    }
                }
            });
            map.addControl(drawControl);

            map.on(L.Draw.Event.CREATED, function (e) {
                var layer = e.layer;
                drawnItems.addLayer(layer);
            });
            
            //Add Geo Json
            // var geojson = new L.GeoJSON.AJAX("/Users/kristenoshea/Documents/UMarylandMasters/WebGIS677/Lab3/test.geojson");
            // geojson.addTo(map);
            // var test = '{"type": "FeatureCollection","features": [{"type": "Feature","properties": {},"geometry": {"coordinates": [[[-76.94891653004191,38.98880666909892],[-76.94891653004191,38.98769754807205],[-76.94747886600985,38.98769754807205],[-76.94747886600985,38.98880666909892],[-76.94891653004191,38.98880666909892]]],"type": "Polygon"}}]}'
            // var test2 =JSON.parse(test)
            // L.geoJSON(test2).addTo(map);
            fetch('./test.geojson')
                .then(response => response.json())
                .then(geojsonData => {
                    // Add GeoJSON data to the map
                    L.geoJSON(geojsonData).addTo(map).bindPopup('University of Maryland Campus');
                }).catch(error => {console.error('Error loading GeoJSON:', error);});
            
            //Geocoder
            var osmGeocoder = new L.Control.OSMGeocoder();
            map.addControl(osmGeocoder);

        //     map.on('click', function(e) {
        //         drawnItems.eachLayer(function(layer) {
        //             if (layer instanceof L.Marker && layer.getBounds().contains(e.latlng)) {
        //                 drawnItems.removeLayer(layer);
        //             } else if (layer instanceof L.Polygon && layer.getBounds().contains(e.latlng)) {
        //                 drawnItems.removeLayer(layer);
        //             }
        //         });
        //     });
        }
        
        
        window.onload = init;

    </script>
  </body>
</html>